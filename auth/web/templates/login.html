<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вход в систему</title>
  <style>
    :root{--primary-dark:#30393E;--primary-light:#988F88;--background:#FAEFEB;--accent:#F8BD97;--secondary:#D5C1B6}
    body{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:var(--background);margin:0;height:100vh;display:flex;align-items:center;justify-content:center;color:var(--primary-dark)}
    .auth-container{background:#fff;border-radius:15px;padding:30px;max-width:400px;width:100%;box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .auth-header{text-align:center;margin-bottom:20px}.auth-title{margin:0 0 6px}.auth-subtitle{color:var(--primary-light);font-size:14px}
    .auth-form{display:flex;flex-direction:column;gap:16px}.input-group{display:flex;flex-direction:column;gap:6px}
    .input-group input{padding:10px;border:1px solid var(--secondary);border-radius:8px}
    .auth-btn{padding:12px;border-radius:8px;background:var(--primary-light);color:#fff;border:none;cursor:pointer}
    .auth-footer{text-align:center;margin-top:14px;color:var(--primary-light)}
    .error-message{color:#e74c3c;font-size:14px;display:none}
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-header">
      <h1 class="auth-title">Вход в аккаунт</h1>
      <p class="auth-subtitle">Введите свои данные для входа</p>
    </div>

    <form id="loginForm" class="auth-form" autocomplete="off">
      <div class="input-group">
        <label for="email">Email</label>
        <input id="email" type="email" required />
        <div id="emailError" class="error-message"></div>
      </div>

      <div class="input-group">
        <label for="password">Пароль</label>
        <input id="password" type="password" required />
        <div id="passwordError" class="error-message"></div>
      </div>

      <button type="submit" class="auth-btn">Войти</button>
    </form>

    <div class="auth-footer">
      Нет аккаунта? <a href="/signup_page">Зарегистрируйтесь</a>
    </div>
  </div>

  <script>
    // Endpoints / redirects
    const AUTH_LOGIN_URL = "/api/login";       // куда отправляем логин (относительно текущего хоста)
    const CHAT_ROOT = "http://localhost:8080/"; // куда переходим после успешного входа

    function showError(msg, elId) {
      if (elId) {
        const el = document.getElementById(elId);
        el.textContent = msg;
        el.style.display = 'block';
        return;
      }
      alert(msg);
    }

    function clearErrors() {
      document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
        el.textContent = '';
      });
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearErrors();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!email) { showError('Введите email', 'emailError'); return; }
      if (!password) { showError('Введите пароль', 'passwordError'); return; }

      try {
        const res = await fetch(AUTH_LOGIN_URL, {
          method: "POST",
          credentials: "include", // если сервер ставит HttpOnly cookie
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const json = await res.json().catch(() => ({}));

        if (!res.ok) {
          const errMsg = json.Error || json.error || json.message || "Ошибка входа";
          showError(errMsg);
          return;
        }

        // Успешный вход — перенаправляем на localhost:8080
        window.location.href = CHAT_ROOT;

      } catch (err) {
        console.error(err);
        showError("Ошибка сети");
      }
    });
  </script>
</body>
</html>